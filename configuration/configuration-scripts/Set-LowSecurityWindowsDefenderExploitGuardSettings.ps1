<#  
	.SYNOPSIS  
	Configures Windows Defender Exploit Guard (WDEG) settings.

	.DESCRIPTION  
	Author: Dane Stuckey (@cryps1s)
	License: MIT

	Configures Windows Defender Exploit Guard (WDEG) Settings. 

	.NOTES 
 #>

Try
{
	# Copy the Exploit Guard Configuration File Locally
	$ConfigFileLocation = "$Env:SystemRoot\System32\Exploit_Guard.xml"
	Copy-Item -Path "$Env:SystemDrive\packer\Windows_Defender_Exploit_Guard_Low_Security_Settings.xml" -Destination $ConfigFileLocation -Force

	
	$RegistryKeyPath = "HKLM:\Software\Policies\Microsoft\Windows Defender ExploitGuard\Exploit Protection"
	If (-not(Test-Path -Path $RegistryKeyPath)) 
	{
		New-Item -Path $RegistryKeyPath -ItemType Directory -Force | Out-Null
	}
	# Add registry value
	New-ItemProperty -Path $RegistryKeyPath -Name "ExploitProtectionSettings" -PropertyType String -Value "$ConfigFileLocation" -Force | Out-Null
}

Catch
{
	Write-Error "Could not implement Windows Defender Exploit Guard configuration settings. Exiting."
	Write-Host $_.Exception | format-list -force;
	Exit 1
}